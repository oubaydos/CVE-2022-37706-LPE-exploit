Vagrant.configure("2") do |config|
    VAGRANT_COMMAND = ARGV[0]
    if VAGRANT_COMMAND == "ssh"
    config.ssh.username = 'normaluser'
    end
  config.vm.box = "bento/ubuntu-20.04"
  config.vm.provision "shell", inline: <<-SHELL
    # Mettre à jour les sources des dépôts et installer les mises à jour identifiée
    sudo apt update && sudo apt upgrade -y  
    # créer un utilisateur normal
    sudo useradd -ms /bin/bash normaluser
    # ajouter l'utilisateur normal au groupe adm (cela donne à l'utilisateur normal les droits pour pouvoir lire les logs)
    sudo usermod -a -G adm normaluser
    # changer le mot de passe de l'utilisateur normal
    sudo echo "normaluser:normaluser" | sudo chpasswd
    # changer le mot de passe de l'utilisateur root
    echo "root:root" | sudo chpasswd
    # installer la version vulnérable 0.23.1-4 du paquet enlightenment
    sudo apt install -y enlightenment=0.23.1-4
    # installer git
    sudo apt install -y git
    # switcher vers l'utilisateur normal
    sudo su - normaluser
    # cloner le repo github de l'exploit
    git clone https://github.com/oubaydos/CVE-2022-37706-LPE-exploit /home/normaluser/POC
    # changer le repertoire courant
    cd /home/normaluser/POC
    # maintenant vous pouvez lancer l'exploit
    # en tant qu'utilisateur normal
    # en éxecutant la commande suivante
    # ./exploit.sh
  SHELL
end
